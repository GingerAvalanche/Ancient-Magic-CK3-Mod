#Mind Magic
entrance_spell = {
	scope = character
	is_shown = {
		NOT = { this = scope:spell_target }
	}
	is_valid = {
		AND = {
			scope:spell_target = {
				NOT = {
					has_opinion_modifier = {
						target = prev
						modifier = entrance_spell_opinion
					}
				}
			}
			has_enough_mana_trigger = yes
		}
	}
	effect = {
		scope:spell_target = {
			add_opinion = {
				target = prev
				modifier = entrance_spell_opinion
			}
		}
		deduct_mana_with_tooltip = { VALUE = scope:spell_cost }
	}
}

entrance_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = entrance_perk
	}
	is_valid = {
		always = yes
	}
}

entrance_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

entrance_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

incite_lust_spell = {
	scope = character
	is_shown = {
		NOT = { this = scope:spell_target }
	}
	is_valid = {
		AND = {
			NOT = { scope:spell_target = { has_relation_lover = prev } }
			has_enough_mana_trigger = yes
		}
	}
	effect = {
		scope:spell_target = { set_relation_lover = prev }
		deduct_mana_with_tooltip = { VALUE = scope:spell_cost }
	}
}

incite_lust_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = incite_lust_perk
	}
	is_valid = {
		always = yes
	}
}

incite_lust_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

incite_lust_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

incite_obedience_spell = {
	scope = character
	is_shown = {
		NOT = { this = scope:spell_target }
	}
	is_valid = {
		AND = {
			can_add_hook = {
				target = scope:spell_target
				type = ancient_magic_hook_obedient
			}
			has_enough_mana_trigger = yes
		}
	}
	effect = {
		add_hook = {
			target = scope:spell_target
			type = ancient_magic_hook_obedient
		}
		deduct_mana_with_tooltip = { VALUE = scope:spell_cost }
	}
}

incite_obedience_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = incite_obedience_perk
	}
	is_valid = {
		always = yes
	}
}

incite_obedience_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

incite_obedience_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

dominate_spell = {
	scope = character
	is_shown = {
		NOT = { this = scope:spell_target }
	}
	is_valid = {
		AND = {
			NOT = { has_strong_hook = scope:spell_target }
			has_enough_mana_trigger = yes
		}
	}
	effect = {
		if = {
			limit = { has_hook = scope:spell_target }
			hidden_effect = { use_hook = scope:spell_target }
		}
		add_hook = {
			target = scope:spell_target
			type = ancient_magic_hook_dominated
		}
		deduct_mana_with_tooltip = { VALUE = scope:spell_cost }
	}
}

dominate_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = dominate_perk
	}
	is_valid = {
		always = yes
	}
}

dominate_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

dominate_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

beguiling_aura_spell = { # aura of majesty
	scope = character
	is_shown = {
		this = scope:spell_target
	}
	is_valid = {
		has_enough_mana_trigger = yes
	}
	effect = {
		if = {
			limit = { NOT = { has_character_modifier = beguiling_aura_modifier } }
			add_character_modifier = beguiling_aura_modifier
			display_aura_times = { VALUE = mage_level }
			deduct_mana_with_tooltip = { VALUE = scope:spell_cost }
			deduct_mana_gen_tooltip = { VALUE = mana_drain_average }
		}
		else = {
			remove_all_character_modifier_instances = beguiling_aura_modifier
			change_mana_gen_tooltip = { VALUE = mana_drain_average }
		}
	}
}

beguiling_aura_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = beguiling_aura_perk
	}
	is_valid = {
		always = yes
	}
}

beguiling_aura_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

beguiling_aura_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

friendship_spell = {
	scope = character
	is_shown = {
		NOT = { this = scope:spell_target }
	}
	is_valid = {
		AND = {
			NOT = { scope:spell_target = { has_relation_friend = prev } }
			has_enough_mana_trigger = yes
		}
	}
	effect = {
		scope:spell_target = { set_relation_friend = prev }
		deduct_mana_with_tooltip = { VALUE = scope:spell_cost }
	}
}

friendship_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = friendship_perk
	}
	is_valid = {
		always = yes
	}
}

friendship_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

friendship_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

rivalry_spell = {
	scope = character
	is_shown = {
		NOT = { this = scope:spell_target }
	}
	is_valid = {
		AND = {
			NOT = { scope:spell_target = { has_relation_rival = prev } }
			has_enough_mana_trigger = yes
		}
	}
	effect = {
		scope:spell_target = { set_relation_rival = prev }
		deduct_mana_with_tooltip = { VALUE = scope:spell_cost }
	}
}

rivalry_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = friendship_perk
	}
	is_valid = {
		always = yes
	}
}

rivalry_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

rivalry_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

enchanting_aura_spell = { # aura of truth
	scope = character
	is_shown = {
		this = scope:spell_target
	}
	is_valid = {
		has_enough_mana_trigger = yes
	}
	effect = {
		if = {
			limit = { NOT = { has_character_modifier = enchanting_aura_modifier } }
			add_character_modifier = enchanting_aura_modifier
			display_aura_times = { VALUE = mage_level }
			deduct_mana_with_tooltip = { VALUE = scope:spell_cost }
			deduct_mana_gen_tooltip = { VALUE = mana_drain_large }
		}
		else = {
			remove_all_character_modifier_instances = enchanting_aura_modifier
			change_mana_gen_tooltip = { VALUE = mana_drain_large }
		}
	}
}

enchanting_aura_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = enchanting_aura_perk
	}
	is_valid = {
		always = yes
	}
}

enchanting_aura_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

enchanting_aura_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

sculpt_mind_spell = {
	scope = character
	is_shown = {
		always = yes
	}
	is_valid = {
		AND = {
			has_variable_list = selected_list_options
			variable_list_size = { name = selected_list_options value > 0 }
			num_target_personality_traits <= personality_trait_limit
			has_enough_mana_trigger = yes
		}
	}
	effect = {
		every_in_list = {
			variable = selected_list_options
			switch = {
				trigger = this
				flag:lustful = {
					scope:spell_target = {
						if = { limit = { has_trait = lustful } remove_trait = lustful }
						else = { add_trait = lustful }
					}
				}
				flag:chaste = {
					scope:spell_target = {
						if = { limit = { has_trait = chaste } remove_trait = chaste }
						else = { add_trait = chaste }
					}
				}
				flag:gluttonous = {
					scope:spell_target = {
						if = { limit = { has_trait = gluttonous } remove_trait = gluttonous }
						else = { add_trait = gluttonous }
					}
				}
				flag:temperate = {
					scope:spell_target = {
						if = { limit = { has_trait = temperate } remove_trait = temperate }
						else = { add_trait = temperate }
					}
				}
				flag:greedy = {
					scope:spell_target = {
						if = { limit = { has_trait = greedy } remove_trait = greedy }
						else = { add_trait = greedy }
					}
				}
				flag:generous = {
					scope:spell_target = {
						if = { limit = { has_trait = generous } remove_trait = generous }
						else = { add_trait = generous }
					}
				}
				flag:lazy = {
					scope:spell_target = {
						if = { limit = { has_trait = lazy } remove_trait = lazy }
						else = { add_trait = lazy }
					}
				}
				flag:diligent = {
					scope:spell_target = {
						if = { limit = { has_trait = diligent } remove_trait = diligent }
						else = { add_trait = diligent }
					}
				}
				flag:wrathful = {
					scope:spell_target = {
						if = { limit = { has_trait = wrathful } remove_trait = wrathful }
						else = { add_trait = wrathful }
					}
				}
				flag:calm = {
					scope:spell_target = {
						if = { limit = { has_trait = calm } remove_trait = calm }
						else = { add_trait = calm }
					}
				}
				flag:impatient = {
					scope:spell_target = {
						if = { limit = { has_trait = impatient } remove_trait = impatient }
						else = { add_trait = impatient }
					}
				}
				flag:patient = {
					scope:spell_target = {
						if = { limit = { has_trait = patient } remove_trait = patient }
						else = { add_trait = patient }
					}
				}
				flag:arrogant = {
					scope:spell_target = {
						if = { limit = { has_trait = arrogant } remove_trait = arrogant }
						else = { add_trait = arrogant }
					}
				}
				flag:humble = {
					scope:spell_target = {
						if = { limit = { has_trait = humble } remove_trait = humble }
						else = { add_trait = humble }
					}
				}
				flag:deceitful = {
					scope:spell_target = {
						if = { limit = { has_trait = deceitful } remove_trait = deceitful }
						else = { add_trait = deceitful }
					}
				}
				flag:honest = {
					scope:spell_target = {
						if = { limit = { has_trait = honest } remove_trait = honest }
						else = { add_trait = honest }
					}
				}
				flag:craven = {
					scope:spell_target = {
						if = { limit = { has_trait = craven } remove_trait = craven }
						else = { add_trait = craven }
					}
				}
				flag:brave = {
					scope:spell_target = {
						if = { limit = { has_trait = brave } remove_trait = brave }
						else = { add_trait = brave }
					}
				}
				flag:shy = {
					scope:spell_target = {
						if = { limit = { has_trait = shy } remove_trait = shy }
						else = { add_trait = shy }
					}
				}
				flag:gregarious = {
					scope:spell_target = {
						if = { limit = { has_trait = gregarious } remove_trait = gregarious }
						else = { add_trait = gregarious }
					}
				}
				flag:ambitious = {
					scope:spell_target = {
						if = { limit = { has_trait = ambitious } remove_trait = ambitious }
						else = { add_trait = ambitious }
					}
				}
				flag:content = {
					scope:spell_target = {
						if = { limit = { has_trait = content } remove_trait = content }
						else = { add_trait = content }
					}
				}
				flag:arbitrary = {
					scope:spell_target = {
						if = { limit = { has_trait = arbitrary } remove_trait = arbitrary }
						else = { add_trait = arbitrary }
					}
				}
				flag:just = {
					scope:spell_target = {
						if = { limit = { has_trait = just } remove_trait = just }
						else = { add_trait = just }
					}
				}
				flag:cynical = {
					scope:spell_target = {
						if = { limit = { has_trait = cynical } remove_trait = cynical }
						else = { add_trait = cynical }
					}
				}
				flag:zealous = {
					scope:spell_target = {
						if = { limit = { has_trait = zealous } remove_trait = zealous }
						else = { add_trait = zealous }
					}
				}
				flag:paranoid = {
					scope:spell_target = {
						if = { limit = { has_trait = paranoid } remove_trait = paranoid }
						else = { add_trait = paranoid }
					}
				}
				flag:trusting = {
					scope:spell_target = {
						if = { limit = { has_trait = trusting } remove_trait = trusting }
						else = { add_trait = trusting }
					}
				}
				flag:callous = {
					scope:spell_target = {
						if = { limit = { has_trait = callous } remove_trait = callous }
						else = { add_trait = callous }
					}
				}
				flag:compassionate = {
					scope:spell_target = {
						if = { limit = { has_trait = compassionate } remove_trait = compassionate }
						else = { add_trait = compassionate }
					}
				}
				flag:vengeful = {
					scope:spell_target = {
						if = { limit = { has_trait = vengeful } remove_trait = vengeful }
						else = { add_trait = vengeful }
					}
				}
				flag:forgiving = {
					scope:spell_target = {
						if = { limit = { has_trait = forgiving } remove_trait = forgiving }
						else = { add_trait = forgiving }
					}
				}
				flag:fickle = {
					scope:spell_target = {
						if = { limit = { has_trait = fickle } remove_trait = fickle }
						else = { add_trait = fickle }
					}
				}
				flag:stubborn = {
					scope:spell_target = {
						if = { limit = { has_trait = stubborn } remove_trait = stubborn }
						else = { add_trait = stubborn }
					}
				}
				flag:sadistic = {
					scope:spell_target = {
						if = { limit = { has_trait = sadistic } remove_trait = sadistic }
						else = { add_trait = sadistic }
					}
				}
				flag:shrewd = {
					scope:spell_target = {
						if = { limit = { has_trait = shrewd } remove_trait = shrewd }
						else = { add_trait = shrewd }
					}
				}
				flag:dull = {
					scope:spell_target = {
						if = { limit = { has_trait = dull } remove_trait = dull }
						else = { add_trait = dull }
					}
				}
				flag:stuttering = {
					scope:spell_target = {
						if = { limit = { has_trait = stuttering } remove_trait = stuttering }
						else = { add_trait = stuttering }
					}
				}
				flag:silver_tongued = {
					scope:spell_target = {
						if = { limit = { has_trait = silver_tongued } remove_trait = silver_tongued }
						else = { add_trait = silver_tongued }
					}
				}
				flag:depressed_genetic = {
					scope:spell_target = {
						if = { limit = { has_trait = depressed_genetic } remove_trait = depressed_genetic }
						else = { add_trait = depressed_genetic }
					}
				}
				flag:possessed_genetic = {
					scope:spell_target = {
						if = { limit = { has_trait = possessed_genetic } remove_trait = possessed_genetic }
						else = { add_trait = possessed_genetic }
					}
				}
				flag:lunatic_genetic = {
					scope:spell_target = {
						if = { limit = { has_trait = lunatic_genetic } remove_trait = lunatic_genetic }
						else = { add_trait = lunatic_genetic }
					}
				}
				flag:dyslexic = {
					scope:spell_target = {
						if = { limit = { has_trait = dyslexic } remove_trait = dyslexic }
						else = { add_trait = dyslexic }
					}
				}
				flag:hyperlexic = {
					scope:spell_target = {
						if = { limit = { has_trait = hyperlexic } remove_trait = hyperlexic }
						else = { add_trait = hyperlexic }
					}
				}
				flag:dyscalculic = {
					scope:spell_target = {
						if = { limit = { has_trait = dyscalculic } remove_trait = dyscalculic }
						else = { add_trait = dyscalculic }
					}
				}
				flag:hypercalculic = {
					scope:spell_target = {
						if = { limit = { has_trait = hypercalculic } remove_trait = hypercalculic }
						else = { add_trait = hypercalculic }
					}
				}
			}
		}
		deduct_mana_with_tooltip = { VALUE = scope:spell_cost }
	}
}

sculpt_mind_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = master_of_puppets_perk
	}
	is_valid = {
		always = yes
	}
}

sculpt_mind_spell_has_properties = {
	scope = character
	is_shown = {
		always = yes
	}
	is_valid = {
		always = no
	}
}

sculpt_mind_spell_has_list = {
	scope = character
	is_shown = {
		always = yes
	}
	is_valid = {
		switch = {
			trigger = scope:list_option
			flag:lustful = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = lustful LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = chaste LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:chaste = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = chaste LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = lustful LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:gluttonous = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = gluttonous LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = temperate LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:temperate = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = temperate LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = gluttonous LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:greedy = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = greedy LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = generous LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:generous = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = generous LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = greedy LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:lazy = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = lazy LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = diligent LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:diligent = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = diligent LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = lazy LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:wrathful = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = wrathful LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = calm LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:calm = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = calm LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = wrathful LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:impatient = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = impatient LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = patient LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:patient = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = patient LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = impatient LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:arrogant = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = arrogant LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = humble LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:humble = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = humble LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = arrogant LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:deceitful = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = deceitful LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = honest LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:honest = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = honest LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = deceitful LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:craven = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = craven LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = brave LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:brave = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = brave LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = craven LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:shy = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = shy LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = gregarious LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:gregarious = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = gregarious LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = shy LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:ambitious = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = ambitious LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = content LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:content = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = content LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = ambitious LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:arbitrary = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = arbitrary LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = just LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:just = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = just LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = arbitrary LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:cynical = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = cynical LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = zealous LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:zealous = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = zealous LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = cynical LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:paranoid = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = paranoid LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = trusting LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:trusting = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = trusting LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = paranoid LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:callous = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = callous LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = compassionate LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:sadistic = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = sadistic LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = compassionate LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:compassionate = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = compassionate LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = callous LIST_HOLDER = prev } } }
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = sadistic LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:vengeful = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = vengeful LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = forgiving LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:forgiving = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = forgiving LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = vengeful LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:fickle = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = fickle LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = stubborn LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:stubborn = {
				OR = {
					scope:spell_target = { will_have_trait_trigger = { TRAIT = stubborn LIST_HOLDER = prev } }
					AND = {
						NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = fickle LIST_HOLDER = prev } } }
						personality_traits_under_limit_trigger = yes
					}
				}
			}
			flag:shrewd = { NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = dull LIST_HOLDER = prev } } } }
			flag:dull = { NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = shrewd LIST_HOLDER = prev } } } }
			flag:stuttering = {
				OR = {
					is_pih_installed_trigger = no
					NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = silver_tongued LIST_HOLDER = prev } } }
				}
			}
			flag:silver_tongued = { NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = stuttering LIST_HOLDER = prev } } } }
			flag:dyslexic = { NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = hyperlexic LIST_HOLDER = prev } } } }
			flag:hyperlexic = { NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = dyslexic LIST_HOLDER = prev } } } }
			flag:dyscalculic = { NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = hypercalculic LIST_HOLDER = prev } } } }
			flag:hypercalculic = { NOT = { scope:spell_target = { will_have_trait_trigger = { TRAIT = dyscalculic LIST_HOLDER = prev } } } }
			fallback = { always = yes }
		}
	}
}

master_of_puppets_spell = {
	scope = character
	is_shown = {
		NOT = { this = scope:spell_target }
	}
	is_valid = {
		AND = {
			can_add_hook = {
				target = scope:spell_target
				type = ancient_magic_hook_dominated
			}
			has_enough_mana_trigger = yes
		}
	}
	effect = {
		add_hook = {
			target = scope:spell_target
			type = ancient_magic_hook_puppet
		}
		deduct_mana_with_tooltip = { VALUE = scope:spell_cost }
	}
}

master_of_puppets_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = master_of_puppets_perk
	}
	is_valid = {
		always = yes
	}
}

master_of_puppets_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

master_of_puppets_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}
