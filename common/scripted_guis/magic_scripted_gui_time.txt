#Time
glimpse_the_future_spell = {
	scope = character
	is_shown = {
		this = scope:spell_target
	}
	is_valid = {
		has_enough_mana_trigger = { SPELL = glimpse_the_future_spell }
	}
	effect = {
		if = {
			limit = { NOT = { has_character_modifier = glimpse_the_future_modifier } }
			add_character_modifier = glimpse_the_future_modifier
			display_aura_times = { VALUE = mage_level }
			change_mana_with_tooltip = { VALUE = glimpse_the_future_spell_cost.neg }
			change_mana_gen_tooltip = { VALUE = glimpse_the_future_spell_gen_cost_individual.neg }
			change_mage_xp = { VALUE = glimpse_the_future_spell_cost.abs }
		}
		else = {
			remove_all_character_modifier_instances = glimpse_the_future_modifier
			change_mana_gen_tooltip = { VALUE = glimpse_the_future_spell_gen_cost_individual.abs }
		}
	}
}

glimpse_the_future_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = glimpse_the_future_perk
	}
	is_valid = {
		always = yes
	}
}

glimpse_the_future_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

glimpse_the_future_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

financial_times_spell = {
	scope = character
	is_shown = {
		this = scope:spell_target
	}
	is_valid = {
		has_enough_mana_trigger = { SPELL = financial_times_spell }
	}
	effect = {
		if = {
			limit = { NOT = { has_character_modifier = financial_times_modifier } }
			add_character_modifier = financial_times_modifier
			display_aura_times = { VALUE = mage_level }
			change_mana_with_tooltip = { VALUE = financial_times_spell_cost.neg }
			change_mana_gen_tooltip = { VALUE = financial_times_spell_gen_cost_individual.neg }
			change_mage_xp = { VALUE = financial_times_spell_cost.abs }
		}
		else = {
			remove_all_character_modifier_instances = financial_times_modifier
			change_mana_gen_tooltip = { VALUE = financial_times_spell_gen_cost_individual.abs }
		}
	}
}

financial_times_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = financial_times_perk
	}
	is_valid = {
		always = yes
	}
}

financial_times_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

financial_times_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

celerity_spell = {
	scope = character
	is_shown = {
		this = scope:spell_target
	}
	is_valid = {
		has_enough_mana_trigger = { SPELL = celerity_spell }
	}
	effect = {
		if = {
			limit = { NOT = { has_character_modifier = celerity_modifier } }
			add_character_modifier = celerity_modifier
			display_aura_times = { VALUE = mage_level }
			change_mana_with_tooltip = { VALUE = celerity_spell_cost.neg }
			change_mana_gen_tooltip = { VALUE = celerity_spell_gen_cost_individual.neg }
			change_mage_xp = { VALUE = celerity_spell_cost.abs }
		}
		else = {
			remove_all_character_modifier_instances = celerity_modifier
			change_mana_gen_tooltip = { VALUE = celerity_spell_gen_cost_individual.abs }
		}
	}
}

celerity_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = celerity_perk
	}
	is_valid = {
		always = yes
	}
}

celerity_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

celerity_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

mass_celerity_spell = {
	scope = character
	is_shown = {
		this = scope:spell_target
	}
	is_valid = {
		has_enough_mana_trigger = { SPELL = mass_celerity_spell }
	}
	effect = {
		if = {
			limit = { NOT = { has_character_modifier = mass_celerity_modifier } }
			add_character_modifier = mass_celerity_modifier
			display_aura_times = { VALUE = mage_level }
			change_mana_with_tooltip = { VALUE = mass_celerity_spell_cost.neg }
			change_mana_gen_tooltip = { VALUE = mass_celerity_spell_gen_cost_individual.neg }
			change_mage_xp = { VALUE = mass_celerity_spell_cost.abs }
		}
		else = {
			remove_all_character_modifier_instances = mass_celerity_modifier
			change_mana_gen_tooltip = { VALUE = mass_celerity_spell_gen_cost_individual.abs }
		}
	}
}

mass_celerity_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = mass_celerity_perk
	}
	is_valid = {
		always = yes
	}
}

mass_celerity_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

mass_celerity_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

slowness_spell = {
	scope = character
	is_shown = {
		OR = {
			AND = {
				NOT = { scope:spell_target = { has_character_modifier = slowness_modifier } }
				OR = {
					NOT = { has_variable_list = slowness_spell_targets }
					variable_list_size = { name = slowness_spell_targets value < 3 }
				}
			}
			AND = {
				has_variable_list = slowness_spell_targets
				is_target_in_variable_list = { name = slowness_spell_targets target = scope:spell_target }
			}
		}
		NOT = { this = scope:spell_target }
	}
	is_valid = {
		has_enough_mana_trigger = { SPELL = slowness_spell }
	}
	effect = {
		if = {
			limit = { is_target_in_variable_list = { name = slowness_spell_targets target = scope:spell_target } }
			remove_list_variable = { name = slowness_spell_targets target = scope:spell_target }
			scope:spell_target = { remove_all_character_modifier_instances = slowness_modifier }
			change_mana_gen_tooltip = { VALUE = slowness_spell_gen_cost_individual.abs }
		}
		else = {
			save_temporary_scope_value_as = { name = spell_cost value = slowness_spell_cost }
			add_to_variable_list = { name = master_of_time_spell_targets target = scope:spell_target }
			scope:spell_target = { add_character_modifier = slowness_modifier }
			display_aura_times = { VALUE = mage_level }
			change_mana_with_tooltip = { VALUE = slowness_spell_cost.neg }
			change_mana_gen_tooltip = { VALUE = slowness_spell_gen_cost_individual.neg }
			change_mage_xp = { VALUE = slowness_spell_cost.abs }
		}
	}
}

slowness_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = slowness_perk
	}
	is_valid = {
		always = yes
	}
}

slowness_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

slowness_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

mass_slowness_spell = {
	scope = character
	is_shown = {
		OR = {
			AND = {
				NOT = { scope:spell_target = { has_character_modifier = mass_slowness_modifier } }
				OR = {
					NOT = { has_variable_list = mass_slowness_spell_targets }
					variable_list_size = { name = mass_slowness_spell_targets value < 3 }
				}
			}
			AND = {
				has_variable_list = mass_slowness_spell_targets
				is_target_in_variable_list = { name = mass_slowness_spell_targets target = scope:spell_target }
			}
		}
		NOT = { this = scope:spell_target }
	}
	is_valid = {
		has_enough_mana_trigger = { SPELL = mass_slowness_spell }
	}
	effect = {
		if = {
			limit = { is_target_in_variable_list = { name = mass_slowness_spell_targets target = scope:spell_target } }
			remove_list_variable = { name = mass_slowness_spell_targets target = scope:spell_target }
			scope:spell_target = { remove_all_character_modifier_instances = mass_slowness_modifier }
			change_mana_gen_tooltip = { VALUE = mass_slowness_spell_gen_cost_individual.abs }
		}
		else = {
			save_temporary_scope_value_as = { name = spell_cost value = mass_slowness_spell_cost }
			add_to_variable_list = { name = master_of_time_spell_targets target = scope:spell_target }
			scope:spell_target = { add_character_modifier = mass_slowness_modifier }
			display_aura_times = { VALUE = mage_level }
			change_mana_with_tooltip = { VALUE = mass_slowness_spell_cost.neg }
			change_mana_gen_tooltip = { VALUE = mass_slowness_spell_gen_cost_individual.neg }
			change_mage_xp = { VALUE = mass_slowness_spell_cost.abs }
		}
	}
}

mass_slowness_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = mass_slowness_perk
	}
	is_valid = {
		always = yes
	}
}

mass_slowness_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

mass_slowness_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

temporal_manipulation_spell = {
	scope = character
	is_shown = {
		this = scope:spell_target
	}
	is_valid = {
		has_enough_mana_trigger = { SPELL = temporal_manipulation_spell }
	}
	effect = {
		if = {
			limit = { NOT = { has_character_modifier = temporal_manipulation_modifier } }
			add_character_modifier = temporal_manipulation_modifier
			display_aura_times = { VALUE = mage_level }
			change_mana_with_tooltip = { VALUE = temporal_manipulation_spell_cost.neg }
			change_mana_gen_tooltip = { VALUE = temporal_manipulation_spell_gen_cost_individual.neg }
			change_mage_xp = { VALUE = temporal_manipulation_spell_cost.abs }
		}
		else = {
			remove_all_character_modifier_instances = temporal_manipulation_modifier
			change_mana_gen_tooltip = { VALUE = temporal_manipulation_spell_gen_cost_individual.abs }
		}
	}
}

temporal_manipulation_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = temporal_manipulation_perk
	}
	is_valid = {
		always = yes
	}
}

temporal_manipulation_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

temporal_manipulation_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

haste_spell = {
	scope = character
	is_shown = {
		this = scope:spell_target
	}
	is_valid = {
		has_enough_mana_trigger = { SPELL = haste_spell }
	}
	effect = {
		if = {
			limit = { NOT = { has_character_modifier = magic_haste_modifier } }
			add_character_modifier = magic_haste_modifier
			display_aura_times = { VALUE = mage_level }
			change_mana_with_tooltip = { VALUE = haste_spell_cost.neg }
			change_mana_gen_tooltip = { VALUE = haste_spell_gen_cost_individual.neg }
			change_mage_xp = { VALUE = haste_spell_cost.abs }
		}
		else = {
			remove_all_character_modifier_instances = magic_haste_modifier
			change_mana_gen_tooltip = { VALUE = haste_spell_gen_cost_individual.abs }
		}
	}
}

haste_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = temporal_manipulation_perk
	}
	is_valid = {
		always = yes
	}
}

haste_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

haste_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

master_of_time_spell = {
	scope = character
	is_shown = {
		OR = {
			AND = {
				NOT = { scope:spell_target = { has_trait = immortal } }
				OR = {
					NOT = { has_variable_list = master_of_time_spell_targets }
					variable_list_size = { name = master_of_time_spell_targets value < 3 }
				}
			}
			AND = {
				has_variable_list = master_of_time_spell_targets
				is_target_in_variable_list = { name = master_of_time_spell_targets target = scope:spell_target }
			}
		}
	}
	is_valid = {
		has_enough_mana_trigger = { SPELL = master_of_time_spell }
	}
	effect = {
		if = {
			limit = { is_target_in_variable_list = { name = master_of_time_spell_targets target = scope:spell_target } }
			remove_list_variable = { name = master_of_time_spell_targets target = scope:spell_target }
			scope:spell_target = { remove_trait = immortal }
			change_mana_gen_tooltip = { VALUE = master_of_time_spell_gen_cost_individual.abs }
			remove_immortal_years_since_master_of_time_spell = yes
		}
		else = {
			save_temporary_scope_value_as = { name = spell_cost value = master_of_time_spell_cost }
			scope:spell_target = { add_trait = immortal }
			add_to_variable_list = { name = master_of_time_spell_targets target = scope:spell_target }
			change_mana_with_tooltip = { VALUE = scope:spell_cost.neg }
			change_mana_gen_tooltip = { VALUE = master_of_time_spell_gen_cost_individual.neg }
			change_mage_xp = { VALUE = scope:spell_cost.abs }
		}
	}
}

master_of_time_spell_spellbook = {
	scope = character
	is_shown = {
		has_perk = master_of_time_perk
	}
	is_valid = {
		always = yes
	}
}

master_of_time_spell_has_properties = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

master_of_time_spell_has_list = {
	scope = character
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}
