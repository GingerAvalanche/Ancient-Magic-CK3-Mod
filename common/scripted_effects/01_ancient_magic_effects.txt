make_mage_effect = {
	add_trait_force_tooltip = mage
	add_trait_force_tooltip = mana
	if = {
		limit = { NOT = { exists = var:mana } }
		set_variable = {
			name = mana
			value = 0
		}
	}
}

change_mana_with_tooltip = {
	custom_description = {
		text = change_mana
		value = $VALUE$
	}
	change_mana = { VALUE = $VALUE$ }
}

deduct_mana_with_tooltip = {
	if = {
		limit = { $VALUE$ < 0 }
		change_mana_with_tooltip = { VALUE = $VALUE$ }
	}
	else = {
		save_temporary_scope_value_as = {
			name = value_neg
			value = { value = 0 subtract = $VALUE$ }
		}
		change_mana_with_tooltip = { VALUE = scope:value_neg }
	}
}

change_mana_gen_tooltip = {
	custom_description = {
		text = change_mana_gen
		value = $VALUE$
	}
	trigger_event = { on_action = on_reset_mana_system }
}

deduct_mana_gen_tooltip = {
	if = {
		limit = { $VALUE$ < 0 }
		change_mana_gen_tooltip = { VALUE = $VALUE$ }
	}
	else = {
		save_temporary_scope_value_as = {
			name = value_neg
			value = { value = 0 subtract = $VALUE$ }
		}
		change_mana_gen_tooltip = { VALUE = scope:value_neg }
	}
}

change_ancestral_guardians_count = {
	if = {
		limit = {
			NOT = { exists = var:ancestral_guardians_count }
		}
		set_variable = {
			name = ancestral_guardians_count
			value = 0
		}
	}
	change_variable = { name = ancestral_guardians_count add = $VALUE$ }
}

immortal_remove_lifetime_flags = {
	if = { limit = { has_character_flag = has_refunded_perks } remove_character_flag = has_refunded_perks }
	if = { limit = { has_character_flag = declared_major_religious_war_flag } remove_character_flag = declared_major_religious_war_flag }
	if = { limit = { has_character_flag = has_created_a_faith } remove_character_flag = has_created_a_faith }
	if = { limit = { has_character_flag = converted_culture_this_lifetime } remove_character_flag = converted_culture_this_lifetime }
	if = { limit = { has_character_flag = used_lifetime_invasion } remove_character_flag = used_lifetime_invasion }
	if = { limit = { has_character_flag = used_lifetime_subjugation } remove_character_flag = used_lifetime_subjugation }
}

init_immortal_years_since_lifetime_reset = {
	if = {
		limit = {
			NOT = { exists = var:immortal_years_since_lifetime_reset }
		}
		set_variable = {
			name = immortal_years_since_lifetime_reset
			value = 0
		}
	}
}

reset_immortal_years_since_lifetime_reset = {
	set_variable = {
		name = immortal_years_since_lifetime_reset
		value = 0
	}
}

add_immortal_years_since_lifetime_reset = {
	init_immortal_years_since_lifetime_reset = yes
	change_variable = { name = immortal_years_since_lifetime_reset add = 1 }
}

am_remove_minor_illness = {
	remove_trait = smallpox
	remove_trait = sickly
	remove_trait = ill
	remove_trait = early_great_pox
	remove_trait = lovers_pox
	remove_trait = wounded_1
	remove_trait = infirm
}

am_remove_greater_illness = {
	remove_trait = pneumonic
	remove_trait = great_pox
	remove_trait = leper
	remove_trait = wounded_2
	remove_trait = maimed
	remove_trait = gout_ridden
	remove_trait = consumption
	remove_trait = cancer
	remove_trait = typhus
	remove_trait = bubonic_plague
}

am_remove_critical_illness = {
	remove_trait = wounded_3
	remove_trait = one_eyed
	remove_trait = one_legged
	remove_trait = disfigured
	remove_trait = scarred
	remove_trait = eunuch
	remove_trait = blind
	remove_trait = incapable
}

ancient_magic_impregnate_effect = {
	$MOTHER$ = { make_pregnant = { father = $FATHER$ } }
}
