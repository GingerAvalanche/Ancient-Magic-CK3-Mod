change_mage_xp = {
	if = {
		limit = {
			NOT = { exists = var:mage_xp }
		}
		set_variable = {
			name = mage_xp
			value = 0
		}
	}
	change_variable = { name = mage_xp add = $VALUE$ }
}

change_mana = {
	if = {
		limit = {
			$VALUE$ > 0
		}
		custom_description = {
			text = positive_mana_cost
			value = $VALUE$
		}
	}
	else_if = {
		limit = {
			$VALUE$ < 0
		}
		custom_description = {
			text = negative_mana_cost
			value = $VALUE$
		}
	}
	change_variable = { name = mana add = $VALUE$ }
}

change_mana_gen = {
	if = {
		limit = {
			NOT = { exists = var:mana_gen }
		}
		set_variable = {
			name = mana_gen
			value = 0
		}
	}
	if = {
		limit = {
			$VALUE$ > 0
		}
		custom_description = {
			text = positive_mana_drain
			value = $VALUE$
		}
	}
	else_if = {
		limit = {
			$VALUE$ < 0
		}
		custom_description = {
			text = negative_mana_drain
			value = $VALUE$
		}
	}
	change_variable = { name = mana_gen add = $VALUE$ }
}

immortal_remove_lifetime_flags = {
	if = { limit = { has_character_flag = has_refunded_perks } remove_character_flag = has_refunded_perks }
	if = { limit = { has_character_flag = declared_major_religious_war_flag } remove_character_flag = declared_major_religious_war_flag }
	if = { limit = { has_character_flag = has_created_a_faith } remove_character_flag = has_created_a_faith }
	if = { limit = { has_character_flag = converted_culture_this_lifetime } remove_character_flag = converted_culture_this_lifetime }
	if = { limit = { has_character_flag = used_lifetime_invasion } remove_character_flag = used_lifetime_invasion }
	if = { limit = { has_character_flag = used_lifetime_subjugation } remove_character_flag = used_lifetime_subjugation }
}

init_immortal_years_since_lifetime_reset = {
	if = {
		limit = {
			NOT = { exists = var:immortal_years_since_lifetime_reset }
		}
		set_variable = {
			name = immortal_years_since_lifetime_reset
			value = 0
		}
	}
}

reset_immortal_years_since_lifetime_reset = {
	set_variable = {
		name = immortal_years_since_lifetime_reset
		value = 0
	}
}

add_immortal_years_since_lifetime_reset = {
	init_immortal_years_since_lifetime_reset = yes
	change_variable = { name = immortal_years_since_lifetime_reset add = 1 }
}

increase_vanilla_trait_rank = {
	if = {
		limit = {
			has_trait = $TRAIT_PREFIX$_bad_3
		}
		remove_trait = $TRAIT_PREFIX$_bad_3
		add_trait = $TRAIT_PREFIX$_bad_2
	}
	else_if = {
		limit = {
			has_trait = $TRAIT_PREFIX$_bad_2
		}
		remove_trait = $TRAIT_PREFIX$_bad_2
		add_trait = $TRAIT_PREFIX$_bad_1
	}
	else_if = {
		limit = {
			has_trait = $TRAIT_PREFIX$_bad_1
		}
		remove_trait = $TRAIT_PREFIX$_bad_1
	}
	else_if = {
		limit = {
			NOT = { has_trait = $TRAIT_PREFIX$_good }
			NOT = { has_trait = $TRAIT_PREFIX$_bad }
		}
		add_trait = $TRAIT_PREFIX$_good_1
	}
	else_if = {
		limit = {
			has_trait = $TRAIT_PREFIX$_good_1
		}
		remove_trait = $TRAIT_PREFIX$_good_1
		add_trait = $TRAIT_PREFIX$_good_2
	}
	else_if = {
		limit = {
			has_trait = $TRAIT_PREFIX$_good_2
		}
		remove_trait = $TRAIT_PREFIX$_good_2
		add_trait = $TRAIT_PREFIX$_good_3
	}
}

decrease_vanilla_trait_rank = {
	if = {
		limit = {
			has_trait = $TRAIT_PREFIX$_good_3
		}
		remove_trait = $TRAIT_PREFIX$_good_3
		add_trait = $TRAIT_PREFIX$_good_2
	}
	else_if = {
		limit = {
			has_trait = $TRAIT_PREFIX$_good_2
		}
		remove_trait = $TRAIT_PREFIX$_good_2
		add_trait = $TRAIT_PREFIX$_good_1
	}
	else_if = {
		limit = {
			has_trait = $TRAIT_PREFIX$_good_1
		}
		remove_trait = $TRAIT_PREFIX$_good_1
	}
	else_if = {
		limit = {
			NOT = { has_trait = $TRAIT_PREFIX$_good }
			NOT = { has_trait = $TRAIT_PREFIX$_bad }
		}
		add_trait = $TRAIT_PREFIX$_bad_1
	}
	else_if = {
		limit = {
			has_trait = $TRAIT_PREFIX$_bad_1
		}
		remove_trait = $TRAIT_PREFIX$_bad_1
		add_trait = $TRAIT_PREFIX$_bad_2
	}
	else_if = {
		limit = {
			has_trait = $TRAIT_PREFIX$_bad_2
		}
		remove_trait = $TRAIT_PREFIX$_bad_2
		add_trait = $TRAIT_PREFIX$_bad_3
	}
}

check_enough_mana = {
	if = {
		limit = {
			scope:am_spell_caster.var:mana < $SPELL_COST$
		}
		add_character_flag = casting_low_mana_spell
	}
}

check_enough_skill = {
	if = {
		limit = {
			NOT = { has_perk = $SPELL_PERK$ }
		}
		add_character_flag = casting_low_skill_spell
	}
}

am_remove_minor_illness = {
	remove_trait = smallpox
	remove_trait = sickly
	remove_trait = ill
	remove_trait = early_great_pox
	remove_trait = lovers_pox
	remove_trait = wounded_1
	remove_trait = infirm
}

am_remove_greater_illness = {
	remove_trait = pneumonic
	remove_trait = great_pox
	remove_trait = leper
	remove_trait = wounded_2
	remove_trait = maimed
	remove_trait = gout_ridden
	remove_trait = consumption
	remove_trait = cancer
	remove_trait = typhus
	remove_trait = bubonic_plague
}

am_remove_critical_illness = {
	remove_trait = wounded_3
	remove_trait = one_eyed
	remove_trait = one_legged
	remove_trait = disfigured
	remove_trait = scarred
	remove_trait = eunuch
	remove_trait = blind
	remove_trait = incapable
}

add_drained_modifier_scope_work_around = {
	add_character_modifier = {
		modifier = drained_modifier
		years = $YEARS$
	}
}

remove_aura_modifier = {
	if = {
		limit = {
			has_any_spell_aura_modifier = { AURA = $AURA$ }
		}
		custom_description = {
			text = remove_aura_modifier_effect_desc
			remove_character_modifier = $AURA$_modifier_1
			remove_character_modifier = $AURA$_modifier_2
			remove_character_modifier = $AURA$_modifier_3
			remove_character_modifier = $AURA$_modifier_4
			remove_character_modifier = $AURA$_modifier_5
			remove_character_modifier = $AURA$_modifier_6
			remove_character_modifier = $AURA$_modifier_7
			remove_character_modifier = $AURA$_modifier_8
			remove_character_modifier = $AURA$_modifier_9
			remove_character_modifier = $AURA$_modifier_10
			remove_character_modifier = $AURA$_modifier_11
			remove_character_modifier = $AURA$_modifier_12
			remove_character_modifier = $AURA$_modifier_13
			remove_character_modifier = $AURA$_modifier_14
			remove_character_modifier = $AURA$_modifier_15
			remove_character_modifier = $AURA$_modifier_16
			remove_character_modifier = $AURA$_modifier_17
			remove_character_modifier = $AURA$_modifier_18
			remove_character_modifier = $AURA$_modifier_19
			remove_character_modifier = $AURA$_modifier_20
		}
	}
	else = {
		hidden_effect = yes
		remove_all_character_modifier_instances = $AURA$_modifier
		remove_character_modifier = $AURA$_modifier_1
		remove_character_modifier = $AURA$_modifier_2
		remove_character_modifier = $AURA$_modifier_3
		remove_character_modifier = $AURA$_modifier_4
		remove_character_modifier = $AURA$_modifier_5
		remove_character_modifier = $AURA$_modifier_6
		remove_character_modifier = $AURA$_modifier_7
		remove_character_modifier = $AURA$_modifier_8
		remove_character_modifier = $AURA$_modifier_9
		remove_character_modifier = $AURA$_modifier_10
		remove_character_modifier = $AURA$_modifier_11
		remove_character_modifier = $AURA$_modifier_12
		remove_character_modifier = $AURA$_modifier_13
		remove_character_modifier = $AURA$_modifier_14
		remove_character_modifier = $AURA$_modifier_15
		remove_character_modifier = $AURA$_modifier_16
		remove_character_modifier = $AURA$_modifier_17
		remove_character_modifier = $AURA$_modifier_18
		remove_character_modifier = $AURA$_modifier_19
		remove_character_modifier = $AURA$_modifier_20
	}
}
# AURA List:
# magic_haste, beguiling_aura, enchanting_aura, glimpse_the_future, financial_times,
# celerity, slowness, mass_slowness, temporal_manipulation, flame_aura, flaming_weapons,
# living_earthworks, control_water, drought, elemental_warrior, aura_of_death
#
# Level is a value between 1-20 (Usually equivalent to mage_level value)

add_aura_modifier = {
	remove_aura_modifier = { AURA = $AURA$ }
	if = {
		limit = {
			mage_level < 1 # Here in case of some funkiness with mage_level
		}
		add_character_modifier = $AURA$_modifier_1
	}
	else_if = {
		limit = {
			mage_level = 1
		}
		add_character_modifier = $AURA$_modifier_1
	}
	else_if = {
		limit = {
			mage_level = 2
		}
		add_character_modifier = $AURA$_modifier_2
	}
	else_if = {
		limit = {
			mage_level = 3
		}
		add_character_modifier = $AURA$_modifier_3
	}
	else_if = {
		limit = {
			mage_level = 4
		}
		add_character_modifier = $AURA$_modifier_4
	}
	else_if = {
		limit = {
			mage_level = 5
		}
		add_character_modifier = $AURA$_modifier_5
	}
	else_if = {
		limit = {
			mage_level = 6
		}
		add_character_modifier = $AURA$_modifier_6
	}
	else_if = {
		limit = {
			mage_level = 7
		}
		add_character_modifier = $AURA$_modifier_7
	}
	else_if = {
		limit = {
			mage_level = 8
		}
		add_character_modifier = $AURA$_modifier_8
	}
	else_if = {
		limit = {
			mage_level = 9
		}
		add_character_modifier = $AURA$_modifier_9
	}
	else_if = {
		limit = {
			mage_level = 10
		}
		add_character_modifier = $AURA$_modifier_10
	}
	else_if = {
		limit = {
			mage_level = 11
		}
		add_character_modifier = $AURA$_modifier_11
	}
	else_if = {
		limit = {
			mage_level = 12
		}
		add_character_modifier = $AURA$_modifier_12
	}
	else_if = {
		limit = {
			mage_level = 13
		}
		add_character_modifier = $AURA$_modifier_13
	}
	else_if = {
		limit = {
			mage_level = 14
		}
		add_character_modifier = $AURA$_modifier_14
	}
	else_if = {
		limit = {
			mage_level = 15
		}
		add_character_modifier = $AURA$_modifier_15
	}
	else_if = {
		limit = {
			mage_level = 16
		}
		add_character_modifier = $AURA$_modifier_16
	}
	else_if = {
		limit = {
			mage_level = 17
		}
		add_character_modifier = $AURA$_modifier_17
	}
	else_if = {
		limit = {
			mage_level = 18
		}
		add_character_modifier = $AURA$_modifier_18
	}
	else_if = {
		limit = {
			mage_level = 19
		}
		add_character_modifier = $AURA$_modifier_19
	}
	else_if = {
		limit = {
			mage_level = 20
		}
		add_character_modifier = $AURA$_modifier_20
	}
	else_if = {
		limit = {
			mage_level > 20 # Here in case of some funkiness with mage_level
		}
		add_character_modifier = $AURA$_modifier_20
	}
}